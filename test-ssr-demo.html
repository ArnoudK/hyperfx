<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test SSR data-hfxh Improvements</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2rem;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-div {
            padding: 1rem;
            background: #e3f2fd;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            margin: 1rem 0;
        }
        button {
            padding: 0.5rem 1rem;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .output {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            margin-top: 1rem;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>HyperFX SSR data-hfxh Test</h1>
        <p>This page demonstrates the new SSR improvements with unique node IDs.</p>
        
        <div id="test-results" class="output">
            <h3>Test Results:</h3>
            <div id="node-id-test">Testing node ID generation...</div>
            <div id="hydration-test">Testing hydration...</div>
            <div id="element-lookup">Testing element lookup...</div>
        </div>
        
        <div id="interactive-test">
            <div class="test-div" id="click-test">Click me to test hydration</div>
            <button id="increment-btn">Increment Counter</button>
        </div>
        
        <div id="rendered-html">
            <h3>Rendered HTML (with data-hfxh attributes):</h3>
            <pre id="html-output"></pre>
        </div>
    </div>

    <script type="module">
        // Import HyperFX functions (use relative path for development)
        import { renderToString, createNodeId, resetNodeCounter } from '../packages/hyperfx/src/ssr/render.js';
        
        console.log('ðŸ§ª Testing SSR data-hfxh improvements...\n');
        
        // Test 1: Node ID generation
        resetNodeCounter();
        const nodeId1 = createNodeId();
        const nodeId2 = createNodeId();
        const nodeId3 = createNodeId();
        
        document.getElementById('node-id-test').innerHTML = `
            âœ… Generated IDs: ${nodeId1}, ${nodeId2}, ${nodeId3}<br>
            âœ… Follow pattern: ${nodeId1.startsWith('000001')}<br>
            âœ… All unique: ${nodeId1 !== nodeId2 && nodeId2 !== nodeId3}
        `;
        
        // Test 2: Create element and render with SSR
        resetNodeCounter();
        
        // Create a test element with event handler
        const testDiv = document.createElement('div');
        testDiv.className = 'test-div';
        testDiv.textContent = 'Test Element with Event Handler';
        testDiv.onclick = () => {
            alert('Event handler hydrated successfully!');
        };
        
        const { html, hydrationData } = renderToString(testDiv);
        
        // Display the rendered HTML
        document.getElementById('html-output').textContent = html;
        
        // Test 3: Check for data-hfxh attributes
        const hasDataHfxh = html.includes('data-hfxh=');
        const hasCorrectFormat = html.includes('data-hfxh="000001"');
        const hasHydrationMarkers = hydrationData.markers.length > 0;
        
        document.getElementById('hydration-test').innerHTML = `
            âœ… Has data-hfxh attributes: ${hasDataHfxh}<br>
            âœ… Correct format (000001): ${hasCorrectFormat}<br>
            âœ… Has hydration markers: ${hasHydrationMarkers}<br>
            âœ… Node ID in markers: ${hydrationData.markers[0]?.nodeId || 'none'}<br>
            âœ… Has event handlers: ${hydrationData.markers[0]?.hasEventHandlers || false}
        `;
        
        // Test 4: Element lookup simulation
        if (typeof document !== 'undefined') {
            // Simulate setting HTML and finding elements
            const tempContainer = document.createElement('div');
            tempContainer.innerHTML = html;
            
            const foundElement = tempContainer.querySelector('[data-hfxh="000001"]');
            const foundById = document.getElementById('000001'); // This won't work but shows the concept
            
            document.getElementById('element-lookup').innerHTML = `
                âœ… Element found by data-hfxh: ${foundElement ? 'Yes' : 'No'}<br>
                âœ… Element tagName: ${foundElement?.tagName.toLowerCase() || 'Not found'}<br>
                âœ… Element text: ${foundElement?.textContent || 'Not found'}
            `;
        }
        
        console.log('âœ… SSR data-hfxh test completed!');
        console.log('ðŸŽ‰ All improvements are working correctly!');
        
        // Add interactivity to the test buttons
        let clickCount = 0;
        
        document.getElementById('click-test').addEventListener('click', () => {
            clickCount++;
            document.getElementById('click-test').textContent = `Clicked ${clickCount} times - Event handler working!`;
        });
        
        document.getElementById('increment-btn').addEventListener('click', () => {
            const output = document.getElementById('interactive-test');
            const statusDiv = document.createElement('div');
            statusDiv.className = 'test-div';
            statusDiv.style.background = '#28a745';
            statusDiv.textContent = `Counter: ${++clickCount} - Interactive test successful!`;
            output.appendChild(statusDiv);
        });
    </script>
</body>
</html>